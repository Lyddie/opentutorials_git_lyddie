<?php 
    include "{$_SERVER[DOCUMENT_ROOT]}/include/config.php";
    include "./session_admin.php";
    
    // 검색회원 리스트
    $searchList = array();
    $search = $_REQUEST['search'];
    if($search != ""){
        $sql = "SELECT * FROM MEMBER
                WHERE 
                    MemberId LIKE '%$search%'
                    OR KaKaoId LIKE '%$search%'
                    OR MemberName LIKE '%$search%'
            ;";
        $result = mysql_query($sql, $dbconn) or die(mysql_error());
        while($row=mysql_fetch_array($result)){
            array_push($searchList, $row);
        }
    }

    // 카톡ID 변경이 필요한 Tutoring_list 리스트
    $tutList = array();
    $sql = "SELECT * FROM Tutoring_list
            WHERE 
                N_Student=0
                AND Content<>11
                AND DATE_FORMAT(Chat_date, '%Y')='2016'
            ORDER BY
                N_Tutoring_list DESC
        ;";
    $result = mysql_query($sql, $dbconn) or die(mysql_error());
    while($row = mysql_fetch_array($result)){
        array_push($tutList, $row);
    }

    // 튜터
    $tutor = array();
    $N_Tutor = array();
    $Name_Tutor = array();
    $sql = "SELECT * FROM Tutor";
    $result = mysql_query($sql, $dbconn) or die(mysql_error());
    while($row = mysql_fetch_array($result)){
        array_push($N_Tutor, $row[N_Tutor]);
        array_push($Name_Tutor, $row[Name_Tutor]);
    }
    $tutor = array_combine($N_Tutor, $Name_Tutor);

?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SB Admin 2 - Bootstrap Admin Theme</title>

    <!-- Bootstrap Core CSS -->
    <link href="../bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- MetisMenu CSS -->
    <link href="../bower_components/metisMenu/dist/metisMenu.min.css" rel="stylesheet">
    <!-- Timeline CSS -->
    <!-- Custom CSS -->
    <link href="../dist/css/sb-admin-2.css" rel="stylesheet">
    <!-- Morris Charts CSS -->

    <!-- Custom Fonts -->
    <link href="../bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        h3{
            margin: 0 auto;
        }
        table{
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div id="wrapper">
        <? include "../common/include/nav.html"; ?>
        <!-- Navigation -->
        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">카카오아이디 변경</h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-md-4">
                    <form name="form" method="post" action="./custom8.html" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6">
                                <h3>회원검색</h3>
                            </div>
                            <div class="col-md-6" >
                                <input name="search" type="text" class="" style="margin-bottom:0;" value="<?=$search?>" placeholder="Search member" />
                                <button type="submit" class="btn btn-default btn-sm">search</button>
                            </div>
                        </div>
                    </form>
                    <table class="table table-bordered table-condensed">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Name</th>
                                <th>MemberId</th>
                                <th>KaKaoId</th>
                                <th>Hp</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?
                            if(count($searchList) == 0){
                            ?>
                            <tr>
                                <td colspan="5">검색된 회원이 없습니다.</td>
                            </tr>
                            <?
                            } else {
                                for($i=0; $i<count($searchList); $i++){
                            ?>
                            <tr>
                                <td><?=($i + 1)?></td>
                                <td><a href="#" onclick="openModal(<?=$searchList[$i][num]?>, '<?=$searchList[$i][MemberName]?>', '<?=$searchList[$i][KaKaoId]?>', 'MEM')"><?=$searchList[$i][MemberName]?></a></td>
                                <td><?=$searchList[$i][MemberId]?></td>
                                <td><?=$searchList[$i][KaKaoId]?></td>
                                <td><?=$searchList[$i][Hp]?></td>
                            </tr>
                            <?
                                }
                            }
                            ?>
                        </tbody>
                    </table>
                </div>
                <div class="col-md-8">
                    <h3>변경필요ID</h3>
                    <form name="form" method="post" action="./custom8.html" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6">
                            </div>
                            <div class="col-md-6">
                            </div>
                        </div>
                    </form>
                    <table class="table table-bordered table-condensed">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>KaKaoID</th>
                                <th>Chat date</th>
                                <th>Chat file</th>
                                <th>Tutor</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?
                            if(count($tutList) == 0){
                            ?>
                            <tr>
                                <td colspan="3">변경이 필요한 ID가 없습니다.</td>
                            </tr>
                            <?
                            } else {
                                for($i=0; $i<count($tutList); $i++){
                                    $chatlog_file = explode("/", $tutList[$i][Chatlog_File]);
                            ?>
                            <tr>
                                <td><?=($i + 1)?></td>
                                <td><a href="#"  onclick="openModal(0, '', '<?=$tutList[$i][Student]?>', 'TL')"><?=$tutList[$i][Student]?></a></td>
                                <td><?=substr($tutList[$i][Chat_date], 0, -3)?></td>
                                <td><?=$chatlog_file[count($chatlog_file)-1]?></td>
                                <td><?=$tutor[$tutList[$i][N_Tutor]]?></td>
                            </tr>
                            <?
                                }
                            }
                            ?>
                        </tbody>
                    </table>
                    <?include "./mem_info.html";?>
                </div>
            </div>
            <!-- /.row -->           
            <?
                            $url = $_SERVER[PHP_SELF];
                            $url_arr = explode("/", $url);
                            $url = $url_arr[count($url_arr) - 1];
            ?>
            <div style="text-align: right; color: gray;">마지막수정: <?=date("Ymd H:i:s",filemtime($url))?></div>
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <script src="../bower_components/jquery/dist/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="../bower_components/metisMenu/dist/metisMenu.min.js"></script>
    <!-- Custom Theme JavaScript -->
    <script src="../dist/js/sb-admin-2.js"></script>
    <script src="../js/js.js"></script>

</body>

</html>